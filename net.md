# 禅与路由器搭建艺术

更新于2022年8月6日, Author(s): 淑慧

这章只有是章名是对原作的拙劣模仿，笔者文字功底有限，在此稍微概括一下优化网络体验的方法。

## 基本情况

🐔带的校园网分为两种：10元/月的单出口网络和30元/月的多出口网络（年付300元），为了获得多设备连接和稳定的网络体验，建议选择多出口网络

无线连接：有两个802.11n的AP，信号基本覆盖全校。SSID分别为JNU和JNU-Secure，JNU无密码，通过中央RADIUS服务器用户认证；JNU-Secure使用802.11x协议，连接更稳定，但是这两个无线网都 慢 的 离 谱（15-20mbps）

有线连接：经过两层NAT转发，无公网ipv4，ipv6阻断一切传入连接。使用锐捷V3认证，有被动多设备检测（通过UA），挂PT、挖矿之类的会被晶哥找上门。速度最快是对称千兆（有图为证），日常使用中最低降速至百兆左右

校园网可以通过教育网出口访问其他isp无法访问的网站（e.g. Google），但科学上网依旧是必要的

多出口网络最多连接3个无线设备或1个无线设备+1个有线设备 设备数量超出会无法登陆（不会自动登出有线设备）

## 网络共享

**首先声明一点，使用共享网络（包括路由器和开热点）会被封号，因为只是通过检测UA，故有三种方式可以规避这个问题：**

1. 用Openwrt上Privoxy插件修改User-Agent，参考[这篇文章](https://www.right.com.cn/forum/thread-249325-1-1.html)，测试发现一般mt7621的路由器使用此插件时会卡的几乎不可用，软路由用户可以考虑此方案
2. 使用相同类型的设备连接同一个路由器，和舍友串通好，铺设多个路由器
3. 使用苹果全家桶

封号有一定随机性，并不是必然事件，首次封号15分钟，此后为2小时。如果不介意偶尔被封一次号的话，使用一台路由器亦可

### 基础方案

电脑登陆锐捷后打开任务管理器，把8021x.exe杀掉，使用电脑开热点，这是最简单的绕开多网卡检测的方法，但是显然不够优雅

linux或macOS用户sudo kill掉之后会导致锐捷崩溃，只能选择mentohust/MiniEAP方案

### 路由器选购

考虑到学校的网络环境，本着节约的原则，建议选择千兆WAN口的Wi-Fi5路由器，注意：路由器需要是适配了openwrt或者pandavan系统的型号

最节约方案：小米路由器3G/3Gv2/4/4a千兆版，这些路由器本质上都是mt7621a，只是披上了不同的马甲 （闲鱼参考价格40元）

垃圾佬方案：斐讯k2p k2t k3，极路由（百元以内）

富哥们的方案：小米ac2100（150r）

### 刷入OpenWrt/Pandavan

刷入固件的方式大同小异，即先刷入breed，再使用breed刷入

具体步骤请在恩山论坛搜索「路由器名称+刷Pandavan」，有详细的教程可供参考

### 在OpenWrt/Pandavan上使用Mentohust

因为学校的锐捷认证只是老版的V3，没有必要自找麻烦使用MiniEAP

Pandavan自带Mentohust, Open Wrt可以找到别人编译好的软件包，直接通过ssh使用opkg install即可

在此分享一下mentohust的参数

| Ping主机     | 默认        |
| ------------ | ----------- |
| 认证超时     | 8           |
| 心跳间隔     | 2           |
| 失败等待     | 4           |
| 允许失败次数 | 8           |
| 组播方式     | 1（锐捷）   |
| DHCP方式     | 2（认证后） |
| 是否后台运行 | 都行        |
| 客户端版本号 | 4.98        |

